# Usar Node 22 Alpine (mais leve)
FROM node:22-alpine

# Definir diretório de trabalho
WORKDIR /app

# Instalar dependências do sistema necessárias para Prisma + MySQL
RUN apk add --no-cache openssl

# Copiar arquivos de dependências primeiro (cache do Docker)
COPY package*.json ./

# Se você tem pasta prisma, copiar também
COPY prisma ./prisma/

# Instalar dependências
RUN npm install

# Gerar Prisma Client (se você configurou o Prisma)
RUN npx prisma generate

# Copiar todo o código
COPY . .

# Compilar TypeScript
RUN npm run build:ts

# Expor porta 3001 (conforme docker-compose)
EXPOSE 3001

# Comando para rodar a aplicação
CMD ["npm", "start"]